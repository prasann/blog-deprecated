<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="keywords" content="android, NTP, SNTP">
<meta name="description" content="Using NTP time in the anroid application. This involves calling the SNTP server and also converting the time to UTC format.">
 <meta content="670156599751120" property="fb:app_id">
<meta property="og:title" content="UTC time in Android device. With NTP server sync.">
<meta property="og:type" content="website">
<meta property="og:url" content="http://prasans.info/2014/02/utc-time-android-device-ntp-server-sync/">
<meta property="og:image" content="/assets/images/profile.jpg">
<meta property="og:description" content="Using NTP time in the anroid application. This involves calling the SNTP server and also converting the time to UTC format.">
<meta property="og:site_name" content="Feel My Presence">
<meta property="og:locale" content="en"> 
<meta property="article:published_time" content="2014-02-14T00:00:00+00:00">
<meta property="article:author" content="Prasanna"> 
<meta property="og:see_also" content="http://prasans.info/2018/04/add-redux-middleware-dynamically/"> 
<meta property="og:see_also" content="http://prasans.info/2018/03/start-nginx-when-upstream-unavailable/"> 
<meta property="og:see_also" content="http://prasans.info/2018/02/soap-call-in-clojure-compojure-with-saaj/">  

  <title>UTC time in Android device. With NTP server sync.</title>
  <link rel="stylesheet" type="text/css" href="../../../assets/css/post.css">
  <link rel="alternate" type="application/rss+xml" title="Random Presence" href="http://prasans.info/feed.xml">
</head>

<body>
  <nav class="navbar navbar-fixed-top navbar-default" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">
        
        Random Presence
        
      </a>

    </div>
    <div class="collapse navbar-collapse">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="/">Home</a></li>
        <li><a href="https://github.com/prasann">Github</a></li>
        <li><a href="/me">Me</a></li>
        <li><a href="http://feeds.prasans.info/prasans">Feed</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="blog_header">
  
</div>
 <div class="title">
  <h1>UTC time in Android device. With NTP server sync.</h1>
  <div class="date_tag">
    <div class="date">14 February, 2014.</div>
    <div class="tags">
      <em>Under: 
                 
                <a href="/categories/android">android</a> 
                 
                <a href="/categories/"></a> 
                 
                <a href="/categories/"></a> 
            </em>
    </div>
  </div>
</div>
 <div class="post">
<p>I had a requirement to persist the current UTC time of a request in Android device for future reference.</p>
<p>Getting the time from the Android device and converting it to UTC will not be efficient since, user might have set wrong time in the device and it might mislead the data.<br />
So we decided to sync the device with NTP server before converting the time to UTC.</p>
<p><span style="text-decoration: underline;"><strong>Step 1 :</strong></span> Copy this <a title="SntpClient.java" href="https://gist.github.com/prasann/9003350" target="_blank">SntpClient.java</a> into your source.<br />
<span style="text-decoration: underline;"><strong>Step 2 :</strong></span> The SntpService.java to compute the current UTC is here below.</p>
<pre class="prettyprint">public String getUTCTime(){
        long nowAsPerDeviceTimeZone = 0;
        SntpClient sntpClient = new SntpClient();

        if (sntpClient.requestTime("0.africa.pool.ntp.org", 30000)) {
            nowAsPerDeviceTimeZone = sntpClient.getNtpTime();
            Calendar cal = Calendar.getInstance();
            TimeZone timeZoneInDevice = cal.getTimeZone();
            int differentialOfTimeZones = timeZoneInDevice.getOffset(System.currentTimeMillis());
            nowAsPerDeviceTimeZone -= differentialOfTimeZones;
        }
        return DateUtils.getFormattedDateTime(new Date(nowAsPerDeviceTimeZone));
    }</pre>
<p>Some more details on SntpService code:</p>
<p>Connect to any of the prominent ntp servers. There were lots of recommendation to place this in config file, however i thought it doesn't make sense for Android since i have to repackage this anyways.</p>
<pre class="prettyprint">sntpClient.getNtpTime()</pre>
<p>gives you the current NTP time as per the device time zone.</p>
<p>Then identify the device's time zone,</p>
<pre class="prettyprint">cal.getTimeZone()</pre>
<p>and calculate the offset difference between UTC and the current device time.</p>
<pre class="prettyprint">DateUtils.getFormattedDateTime(date)</pre>
<p>is our custom method to format date into String.</p>
</div> <div class="text-center">
	<a href="http://www.facebook.com/sharer/sharer.php?u=http://prasans.info/2014/02/utc-time-android-device-ntp-server-sync/" class="btn-share facebook">Share</a>
	<a href="http://twitter.com/intent/tweet?text=UTC time in Android device. With NTP server sync. : http://prasans.info/2014/02/utc-time-android-device-ntp-server-sync/" class="btn-share twitter">Tweet</a>
</div>
 <div id="page-navigation">
  <div class="prev-link">
    
    <a href="/2013/11/castle-gorge-hiking-with-jhc/" title="Previous Post:
Hike to Castle Gorge with JHC">&laquo; Hike to Castle Gorge with JHC</a> 
  </div>

  <div class="next-link">
    
    <a href="/2014/04/wiring-jasmine2-with-phantom/" title="next Post:
Wiring Jasmine 2.0 with Phantom JS">Wiring Jasmine 2.0 with Phantom JS &raquo; </a> 
  </div>
</div>

  <div id="footer">
	Copyright &copy; 2017 - Prasanna
</div>
<script>
	(function(i, s, o, g, r, a, m) {
		i['GoogleAnalyticsObject'] = r;
		i[r] = i[r] || function() {
			(i[r].q = i[r].q || []).push(arguments)
		}, i[r].l = 1 * new Date();
		a = s.createElement(o),
			m = s.getElementsByTagName(o)[0];
		a.async = 1;
		a.src = g;
		m.parentNode.insertBefore(a, m)
	})(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

	ga('create', 'UA-19478421-1', 'prasans.info');
	ga('send', 'pageview');
</script>

</body>
<script src="../../../assets/js/application.js"></script>

</html>
